diff -rupN jailkit/acinclude.m4 jailkit_wrk/acinclude.m4
--- jailkit/acinclude.m4	1970-01-01 01:00:00.000000000 +0100
+++ jailkit_wrk/acinclude.m4	2013-12-10 22:45:30.832537403 +0100
@@ -0,0 +1,52 @@
+dnl AC_PATH_DIR(VARIABLE, DIR-TO-CHECK-FOR [, VALUE-IF-NOT-FOUND [, PATH]])
+AC_DEFUN([AC_PATH_DIR],
+[# Extract the first word of "$2", so it can be a program name with args.
+set dummy $2; ac_word=[$]2
+AC_MSG_CHECKING([for $ac_word/])
+AC_CACHE_VAL(ac_cv_path_$1,
+[case "[$]$1" in
+  /*)
+  ac_cv_path_$1="[$]$1" # Let the user override the test with a path.
+  ;;
+  ?:/*)
+  ac_cv_path_$1="[$]$1" # Let the user override the test with a dos path.
+  ;;
+  *)
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+dnl $ac_dummy forces splitting on constant user-supplied paths.
+dnl POSIX.2 word splitting is done only on the output of word expansions,
+dnl not every word.  This closes a longstanding sh security hole.
+  ac_dummy="ifelse([$4], , $PATH, [$4])"
+  for ac_dir in $ac_dummy; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -d $ac_dir/$ac_word; then
+      ac_cv_path_$1="$ac_dir/$ac_word"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+dnl If no 3rd arg is given, leave the cache variable unset,
+dnl so AC_PATH_PROGS will keep looking.
+ifelse([$3], , , [  test -z "[$]ac_cv_path_$1" && ac_cv_path_$1="$3"
+])dnl
+  ;;
+esac])dnl
+$1="$ac_cv_path_$1"
+if test -n "[$]$1"; then
+  AC_MSG_RESULT([$]$1)
+else
+  AC_MSG_RESULT(no)
+fi
+AC_SUBST($1)dnl
+])
+
+dnl AC_PATH_DIRS(VARIABLE, DIRSS-TO-CHECK-FOR [, VALUE-IF-NOT-FOUND
+dnl              [, PATH]])
+AC_DEFUN([AC_PATH_DIRS],
+[for ac_dir in $2
+do
+AC_PATH_DIR($1, [$]ac_dir, , $4)
+test -n "[$]$1" && break
+done
+ifelse([$3], , , [test -n "[$]$1" || $1="$3"
+])])
diff -rupN jailkit/aclocal.m4 jailkit_wrk/aclocal.m4
--- jailkit/aclocal.m4	1970-01-01 01:00:00.000000000 +0100
+++ jailkit_wrk/aclocal.m4	2013-12-11 06:51:32.303895329 +0100
@@ -0,0 +1,15 @@
+# generated automatically by aclocal 1.11.6 -*- Autoconf -*-
+
+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
+# 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software Foundation,
+# Inc.
+# This file is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+m4_include([acinclude.m4])
diff -rupN jailkit/configure jailkit_wrk/configure
--- jailkit/configure	2013-04-12 21:47:41.000000000 +0200
+++ jailkit_wrk/configure	2013-12-11 06:51:32.755895319 +0100
@@ -1,13 +1,11 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.68 for jailkit 2.16.
+# Generated by GNU Autoconf 2.69 for jailkit 2.16.
 #
-# Report bugs to <https://savannah.nongnu.org/bugs/?group=jailkit>.
+# Report bugs to <http://trac.i-mscp.net/>.
 #
 #
-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software
-# Foundation, Inc.
+# Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
 #
 #
 # This configure script is free software; the Free Software Foundation
@@ -136,6 +134,31 @@ export LANGUAGE
 # CDPATH.
 (unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
+# Use a proper internal environment variable to ensure we don't fall
+  # into an infinite loop, continuously re-executing ourselves.
+  if test x"${_as_can_reexec}" != xno && test "x$CONFIG_SHELL" != x; then
+    _as_can_reexec=no; export _as_can_reexec;
+    # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+as_fn_exit 255
+  fi
+  # We don't want this to propagate to other subprocesses.
+          { _as_can_reexec=; unset _as_can_reexec;}
 if test "x$CONFIG_SHELL" = x; then
   as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
@@ -169,7 +192,8 @@ if ( set x; as_fn_ret_success y && test
 else
   exitcode=1; echo positional parameters were not saved.
 fi
-test x\$exitcode = x0 || exit 1"
+test x\$exitcode = x0 || exit 1
+test -x / || exit 1"
   as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
   as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
   eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
@@ -214,21 +238,25 @@ IFS=$as_save_IFS
 
 
       if test "x$CONFIG_SHELL" != x; then :
-  # We cannot yet assume a decent shell, so we have to provide a
-	# neutralization value for shells without unset; and this also
-	# works around shells that cannot unset nonexistent variables.
-	# Preserve -v and -x to the replacement shell.
-	BASH_ENV=/dev/null
-	ENV=/dev/null
-	(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
-	export CONFIG_SHELL
-	case $- in # ((((
-	  *v*x* | *x*v* ) as_opts=-vx ;;
-	  *v* ) as_opts=-v ;;
-	  *x* ) as_opts=-x ;;
-	  * ) as_opts= ;;
-	esac
-	exec "$CONFIG_SHELL" $as_opts "$as_myself" ${1+"$@"}
+  export CONFIG_SHELL
+             # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+exit 255
 fi
 
     if test x$as_have_required = xno; then :
@@ -239,10 +267,10 @@ fi
     $as_echo "$0: be upgraded to zsh 4.3.4 or later."
   else
     $as_echo "$0: Please tell bug-autoconf@gnu.org and
-$0: https://savannah.nongnu.org/bugs/?group=jailkit about
-$0: your system, including any error possibly output before
-$0: this message. Then install a modern shell, or manually
-$0: run the script under such a shell if you do have one."
+$0: http://trac.i-mscp.net/ about your system, including
+$0: any error possibly output before this message. Then
+$0: install a modern shell, or manually run the script
+$0: under such a shell if you do have one."
   fi
   exit 1
 fi
@@ -331,6 +359,14 @@ $as_echo X"$as_dir" |
 
 
 } # as_fn_mkdir_p
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
 # as_fn_append VAR VALUE
 # ----------------------
 # Append the text in VALUE to the end of the definition contained in VAR. Take
@@ -452,6 +488,10 @@ as_cr_alnum=$as_cr_Letters$as_cr_digits
   chmod +x "$as_me.lineno" ||
     { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
+  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
+  # already done that, so ensure we don't try to do so again and fall
+  # in an infinite loop.  This has already happened in practice.
+  _as_can_reexec=no; export _as_can_reexec
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
   # original and so on.  Autoconf is especially sensitive to this).
@@ -486,16 +526,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -507,28 +547,8 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -562,7 +582,7 @@ PACKAGE_NAME='jailkit'
 PACKAGE_TARNAME='jailkit'
 PACKAGE_VERSION='2.16'
 PACKAGE_STRING='jailkit 2.16'
-PACKAGE_BUGREPORT='https://savannah.nongnu.org/bugs/?group=jailkit'
+PACKAGE_BUGREPORT='http://trac.i-mscp.net/'
 PACKAGE_URL=''
 
 ac_default_prefix=/usr
@@ -608,6 +628,9 @@ LIBOBJS
 HAVEPROCMAIL_TRUE
 PROCMAILPATH
 PYTHONINTERPRETER
+IMSCPPERLLIB
+PERLINTERPRETER
+IMSCPENGINEDIR
 INSTALL_DATA
 INSTALL_SCRIPT
 INSTALL_PROGRAM
@@ -674,6 +697,8 @@ LDFLAGS
 LIBS
 CPPFLAGS
 CPP
+IMSCPENGINEDIR
+PERLINTERPRETER
 PYTHONINTERPRETER
 PROCMAILPATH'
 
@@ -1131,8 +1156,6 @@ target=$target_alias
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: if you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used" >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1292,6 +1315,12 @@ Some influential environment variables:
   CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
               you have headers in a nonstandard directory <include dir>
   CPP         C preprocessor
+  IMSCPENGINEDIR
+              i-MSCP engine directory with path. Use it to override the
+              default path (/var/www/imscp/engine).
+  PERLINTERPRETER
+              The `perl' binary with path. Use it to define or override the
+              location of `perl'.
   PYTHONINTERPRETER
               The `python' binary with path. Use it to define or override the
               location of `python'.
@@ -1302,7 +1331,7 @@ Some influential environment variables:
 Use these variables to override the choices made by `configure' or to help
 it to find libraries and programs with nonstandard names/locations.
 
-Report bugs to <https://savannah.nongnu.org/bugs/?group=jailkit>.
+Report bugs to <http://trac.i-mscp.net/>.
 _ACEOF
 ac_status=$?
 fi
@@ -1366,9 +1395,9 @@ test -n "$ac_init_help" && exit $ac_stat
 if $ac_init_version; then
   cat <<\_ACEOF
 jailkit configure 2.16
-generated by GNU Autoconf 2.68
+generated by GNU Autoconf 2.69
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -1524,9 +1553,9 @@ $as_echo "$as_me: WARNING: $2: see the A
 $as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
     { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
 $as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
-( $as_echo "## -------------------------------------------------------------- ##
-## Report this to https://savannah.nongnu.org/bugs/?group=jailkit ##
-## -------------------------------------------------------------- ##"
+( $as_echo "## -------------------------------------- ##
+## Report this to http://trac.i-mscp.net/ ##
+## -------------------------------------- ##"
      ) | sed "s/^/$as_me: WARNING:     /" >&2
     ;;
 esac
@@ -1645,7 +1674,7 @@ $as_echo "$ac_try_echo"; } >&5
 	 test ! -s conftest.err
        } && test -s conftest$ac_exeext && {
 	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
+	 test -x conftest$ac_exeext
        }; then :
   ac_retval=0
 else
@@ -1735,7 +1764,7 @@ This file contains any messages produced
 running configure, to aid debugging if configure makes a mistake.
 
 It was created by jailkit $as_me 2.16, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
 
@@ -2130,7 +2159,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -2170,7 +2199,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -2223,7 +2252,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -2264,7 +2293,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -2322,7 +2351,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -2366,7 +2395,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -2812,8 +2841,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -3053,7 +3081,7 @@ do
     for ac_prog in grep ggrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
+      as_fn_executable_p "$ac_path_GREP" || continue
 # Check for GNU ac_path_GREP and select it if it is found.
   # Check for GNU $ac_path_GREP
 case `"$ac_path_GREP" --version 2>&1` in
@@ -3119,7 +3147,7 @@ do
     for ac_prog in egrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
+      as_fn_executable_p "$ac_path_EGREP" || continue
 # Check for GNU ac_path_EGREP and select it if it is found.
   # Check for GNU $ac_path_EGREP
 case `"$ac_path_EGREP" --version 2>&1` in
@@ -3326,8 +3354,8 @@ else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
-#	  define __EXTENSIONS__ 1
-	  $ac_includes_default
+#         define __EXTENSIONS__ 1
+          $ac_includes_default
 int
 main ()
 {
@@ -3381,7 +3409,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3421,7 +3449,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3474,7 +3502,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3515,7 +3543,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -3573,7 +3601,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3617,7 +3645,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3813,8 +3841,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -4063,7 +4090,7 @@ case $as_dir/ in #((
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; }; then
+	if as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
 	  if test $ac_prog = install &&
 	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
@@ -4978,6 +5005,117 @@ done
 
 
 
+
+
+
+# Extract the first word of "perl", so it can be a program name with args.
+set dummy perl; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_PERLINTERPRETER+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $PERLINTERPRETER in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PERLINTERPRETER="$PERLINTERPRETER" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PERLINTERPRETER="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  test -z "$ac_cv_path_PERLINTERPRETER" && ac_cv_path_PERLINTERPRETER="no"
+  ;;
+esac
+fi
+PERLINTERPRETER=$ac_cv_path_PERLINTERPRETER
+if test -n "$PERLINTERPRETER"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PERLINTERPRETER" >&5
+$as_echo "$PERLINTERPRETER" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+if test "x$PERLINTERPRETER" = "xno" ; then
+	as_fn_error $? "perl not found please install perl" "$LINENO" 5
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for up to date perl" >&5
+$as_echo_n "checking for up to date perl... " >&6; }
+if $PERLINTERPRETER -e "use 5.10.1" >/dev/null 2>&1 ; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: ok" >&5
+$as_echo "ok" >&6; }
+else
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: failed" >&5
+$as_echo "failed" >&6; }
+	as_fn_error $? "your perl version is too old, please install perl 1.10.1 or newer" "$LINENO" 5
+fi
+
+# Extract the first word of "PerlLib", so it can be a program name with args.
+set dummy PerlLib; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word/" >&5
+$as_echo_n "checking for $ac_word/... " >&6; }
+if ${ac_cv_path_IMSCPPERLLIB+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case "$IMSCPPERLLIB" in
+  /*)
+  ac_cv_path_IMSCPPERLLIB="$IMSCPPERLLIB" # Let the user override the test with a path.
+  ;;
+  ?:/*)
+  ac_cv_path_IMSCPPERLLIB="$IMSCPPERLLIB" # Let the user override the test with a dos path.
+  ;;
+  *)
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
+  ac_dummy="$IMSCPENGINEDIR"
+  for ac_dir in $ac_dummy; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -d $ac_dir/$ac_word; then
+      ac_cv_path_IMSCPPERLLIB="$ac_dir/$ac_word"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  test -z "$ac_cv_path_IMSCPPERLLIB" && ac_cv_path_IMSCPPERLLIB="/var/www/imscp/engine/PerlLib"
+  ;;
+esac
+fi
+IMSCPPERLLIB="$ac_cv_path_IMSCPPERLLIB"
+if test -n "$IMSCPPERLLIB"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $IMSCPPERLLIB" >&5
+$as_echo "$IMSCPPERLLIB" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+# Check for needed i-MSCP Perl modules
+for module in iMSCP::Debug iMSCP::Getopt iMSCP::Boot ;do
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $module perl module" >&5
+$as_echo_n "checking for $module perl module... " >&6; }
+  if $PERLINTERPRETER -I"$IMSCPPERLLIB" -e 'use '$module &>/dev/null ; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: ok" >&5
+$as_echo "ok" >&6; }
+  else
+    as_fn_error $? "Perl module '$module' not found" "$LINENO" 5
+  fi
+done
+
+
 # Extract the first word of "python", so it can be a program name with args.
 set dummy python; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
@@ -4996,7 +5134,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PYTHONINTERPRETER="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -5025,7 +5163,6 @@ fi
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for up to date python" >&5
 $as_echo_n "checking for up to date python... " >&6; }
-echo -n "checking for up to date python... "
 if $PYTHONINTERPRETER -c 'i=1;i+=1' >/dev/null 2>&1 ; then
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: ok" >&5
 $as_echo "ok" >&6; }
@@ -5054,7 +5191,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PROCMAILPATH="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -5089,7 +5226,7 @@ else
 
 fi
 
-ac_config_files="$ac_config_files Makefile src/Makefile py/Makefile man/Makefile"
+ac_config_files="$ac_config_files Makefile src/Makefile pl/Makefile py/Makefile man/Makefile"
 
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -5498,16 +5635,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -5567,28 +5704,16 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -5610,7 +5735,7 @@ cat >>$CONFIG_STATUS <<\_ACEOF || ac_wri
 # values after options handling.
 ac_log="
 This file was extended by jailkit $as_me 2.16, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -5665,17 +5790,17 @@ $config_files
 Configuration headers:
 $config_headers
 
-Report bugs to <https://savannah.nongnu.org/bugs/?group=jailkit>."
+Report bugs to <http://trac.i-mscp.net/>."
 
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
 jailkit config.status 2.16
-configured by $0, generated by GNU Autoconf 2.68,
+configured by $0, generated by GNU Autoconf 2.69,
   with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
@@ -5764,7 +5889,7 @@ fi
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 if \$ac_cs_recheck; then
-  set X '$SHELL' '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  set X $SHELL '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
   shift
   \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
   CONFIG_SHELL='$SHELL'
@@ -5796,6 +5921,7 @@ do
     "src/config.h") CONFIG_HEADERS="$CONFIG_HEADERS src/config.h" ;;
     "Makefile") CONFIG_FILES="$CONFIG_FILES Makefile" ;;
     "src/Makefile") CONFIG_FILES="$CONFIG_FILES src/Makefile" ;;
+    "pl/Makefile") CONFIG_FILES="$CONFIG_FILES pl/Makefile" ;;
     "py/Makefile") CONFIG_FILES="$CONFIG_FILES py/Makefile" ;;
     "man/Makefile") CONFIG_FILES="$CONFIG_FILES man/Makefile" ;;
 
diff -rupN jailkit/configure.ac jailkit_wrk/configure.ac
--- jailkit/configure.ac	2013-04-12 21:47:41.000000000 +0200
+++ jailkit_wrk/configure.ac	2013-12-11 06:51:06.015895908 +0100
@@ -32,7 +32,7 @@
 #
 #
 
-AC_INIT([jailkit],[2.16],[https://savannah.nongnu.org/bugs/?group=jailkit])
+AC_INIT([jailkit],[2.16],[http://trac.i-mscp.net/])
 
 AC_SUBST([PACKAGE], AC_PACKAGE_NAME)
 AC_DEFINE_UNQUOTED([PACKAGE], "AC_PACKAGE_NAME", [The package name.])
@@ -163,9 +163,44 @@ AC_CHECK_FUNCS(
 	)
 )
 
+AC_ARG_VAR(
+	[IMSCPENGINEDIR],
+	[i-MSCP engine directory with path. Use it to override the default path (/var/www/imscp/engine).]
+)
+AC_SUBST(IMSCPENGINEDIR)
+
 dnl you should maybe add AC_ARG_VAR for every AC_PATH_PROG to allow users
 dnl to specify the binary path if it is not in PATH
 AC_ARG_VAR(
+	[PERLINTERPRETER],
+	[The `perl' binary with path. Use it to define or override the location of `perl'.]
+)
+AC_PATH_PROG([PERLINTERPRETER], [perl], [no])
+if test "x$PERLINTERPRETER" = "xno" ; then
+	AC_MSG_ERROR([perl not found please install perl])
+fi
+AC_SUBST(PERLINTERPRETER)
+AC_MSG_CHECKING([for up to date perl])
+if $PERLINTERPRETER -e "use 5.10.1" >/dev/null 2>&1 ; then
+	AC_MSG_RESULT([ok])
+else
+	AC_MSG_RESULT([failed])
+	AC_MSG_ERROR([your perl version is too old, please install perl 1.10.1 or newer])
+fi
+
+AC_PATH_DIR(IMSCPPERLLIB,PerlLib,/var/www/imscp/engine/PerlLib,$IMSCPENGINEDIR)
+
+# Check for needed i-MSCP Perl modules
+for module in iMSCP::Debug iMSCP::Getopt iMSCP::Boot ;do
+  AC_MSG_CHECKING([for $module perl module])
+  if $PERLINTERPRETER -I"$IMSCPPERLLIB" -e 'use '$module &>/dev/null ; then
+    AC_MSG_RESULT([ok])
+  else
+    AC_MSG_ERROR([Perl module '$module' not found])
+  fi
+done
+
+AC_ARG_VAR(
 	[PYTHONINTERPRETER],
 	[The `python' binary with path. Use it to define or override the location of `python'.]
 )
@@ -175,7 +210,6 @@ if test "x$PYTHONINTERPRETER" = "xno" ;
 fi
 AC_SUBST(PYTHONINTERPRETER)
 AC_MSG_CHECKING([for up to date python])
-echo -n "checking for up to date python... "
 if $PYTHONINTERPRETER -c 'i=1;i+=1' >/dev/null 2>&1 ; then
 	AC_MSG_RESULT([ok])
 else
@@ -195,5 +229,5 @@ else
 	AC_SUBST([HAVEPROCMAIL_TRUE], [#])
 fi
 
-AC_CONFIG_FILES([Makefile src/Makefile py/Makefile man/Makefile])
+AC_CONFIG_FILES([Makefile src/Makefile pl/Makefile py/Makefile man/Makefile])
 AC_OUTPUT
diff -rupN jailkit/extra/jailkit jailkit_wrk/extra/jailkit
--- jailkit/extra/jailkit	2011-08-20 09:30:14.000000000 +0200
+++ jailkit_wrk/extra/jailkit	1970-01-01 01:00:00.000000000 +0100
@@ -1,48 +0,0 @@
-#!/bin/sh
-### BEGIN INIT INFO
-# Provides:          jailkit
-# Required-Start:    $remote_fs $syslog
-# Required-Stop:     $remote_fs $syslog
-# Default-Start:     2 3 4 5
-# Default-Stop:      0 1 6
-# Short-Description: Start jk_socketd at boot time
-# Description:       Enable jk_socketd
-### END INIT INFO
-#
-# start/stop jailkit logging daemon.
-#
-# chkconfig: 2345 60 40
-# description: chroot() jail wrapping utilities
-
-JK_SOCKETD=/usr/sbin/jk_socketd
-
-test -x ${JK_SOCKETD} || exit 0
-
-case "$1" in
-    start)
-	echo -n "Starting jailkit:"
-	echo -n " jk_socketd"
-	${JK_SOCKETD}
-	echo " done."
-	;;
-    stop)
-        echo -n "Stopping jailkit:"
-        echo -n " jk_socketd"
-        killall ${JK_SOCKETD}
-        echo " done."
-	;;
-    restart)
-		$0 stop
-		$0 start
-	;;
-	force-reload)
-		$0 stop
-		$0 start
-	;;
-    *)
-	echo "Usage: $0 {start|stop|restart|force-reload}"
-	exit 1
-	;;
-esac
-
-exit 0
diff -rupN jailkit/extra/jailkit-mountdirs jailkit_wrk/extra/jailkit-mountdirs
--- jailkit/extra/jailkit-mountdirs	1970-01-01 01:00:00.000000000 +0100
+++ jailkit_wrk/extra/jailkit-mountdirs	2013-12-13 18:50:25.643140918 +0100
@@ -0,0 +1,44 @@
+#!/bin/sh
+### BEGIN INIT INFO
+# Provides:          jailkit-mountdirs
+# Required-Start:    $remote_fs $syslog
+# Required-Stop:     $remote_fs $syslog
+# Should-Start:      mysql
+# Should-Stop:       mysql
+# Default-Start:     2 3 4 5
+# Default-Stop:      0 1 6
+# Short-Description: Mount host directories
+# Description:       Mount host directories into jails at boot time
+### END INIT INFO
+
+# Author: Laurent Declercq <l.declercq@nuxwin.com>
+
+PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
+
+# Exit if the programm is not installed
+[ -x jk_mountdirs ] || exit 0
+
+. /lib/lsb/init-functions
+
+case "$1" in
+  start|"")
+  		log_action_begin_msg "Mounting host directories in jails"
+        jk_mountdirs
+        log_action_end_msg $?
+        ;;
+  restart|reload|force-reload)
+        echo "Error: argument '$1' not supported" >&2
+        exit 3
+        ;;
+  stop)
+  		log_action_begin_msg "Umounting host directories from jails"
+        jk_mountdirs --umount
+        log_action_end_msg $?
+        ;;
+  *)
+        echo "Usage: jailkit-mountdirs [start|stop]" >&2
+        exit 3
+        ;;
+esac
+
+:
diff -rupN jailkit/extra/jailkit-socketd jailkit_wrk/extra/jailkit-socketd
--- jailkit/extra/jailkit-socketd	1970-01-01 01:00:00.000000000 +0100
+++ jailkit_wrk/extra/jailkit-socketd	2013-12-11 08:34:53.271758796 +0100
@@ -0,0 +1,107 @@
+#!/bin/sh
+### BEGIN INIT INFO
+# Provides:          jailkit-socketd
+# Required-Start:    $remote_fs $syslog
+# Required-Stop:     $remote_fs $syslog
+# Default-Start:     2 3 4 5
+# Default-Stop:      0 1 6
+# Short-Description: Start and stop jk_socketd
+# Description:       jk_socketd is a daemon to create a
+#        rate-limited /dev/log socket inside a jail
+### END INIT INFO
+
+# Author: Laurent Declercq <l.declercq@nuxwin.com>
+
+PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
+DESC="jailkit daemon"
+NAME=jk_socketd
+DAEMON=/usr/sbin/$NAME
+PIDFILE=/var/run/$NAME.pid
+SCRIPTNAME=/etc/init.d/$NAME
+
+# Exit if the daemon is not installed
+[ -x "$DAEMON" ] || exit 0
+
+. /lib/lsb/init-functions
+
+#
+# Starts the daemon
+#
+do_start()
+{
+	# Return
+	#  0 if daemon has been started
+	#  1 if daemon was already running
+	#  2 if daemon could not be started
+	start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON \
+		--test > /dev/null || return 1
+
+	start-stop-daemon --start --quiet --pidfile $PIDFILE --exec $DAEMON -- \
+		--pidfile $PIDFILE || return 2
+}
+
+#
+# Stops the daemon
+#
+do_stop()
+{
+	# Return
+	#  0 if daemon has been stopped
+	#  1 if daemon was already stopped
+	#  2 if daemon could not be stopped
+	#  other if a failure occurred
+	start-stop-daemon --stop --quiet --retry=TERM/30/KILL/5 --pidfile $PIDFILE \
+		--name $NAME
+	RETVAL="$?"
+	[ "$RETVAL" = 2 ] && return 2
+
+	# Many daemons don't delete their pidfiles when they exit.
+	rm -f $PIDFILE
+	return "$RETVAL"
+}
+
+case "$1" in
+  start)
+	log_daemon_msg "Starting $DESC" "$NAME "
+	do_start
+	case "$?" in
+		0|1) log_end_msg 0 ;;
+		2)   log_end_msg 1 ;;
+	esac
+	;;
+  stop)
+	log_daemon_msg "Stopping $DESC" "$NAME "
+	do_stop
+	case "$?" in
+		0|1) log_end_msg 0 ;;
+		2)   log_end_msg 1 ;;
+	esac
+	;;
+  status)
+	status_of_proc "$DAEMON" "$NAME " && exit 0 || exit $?
+	;;
+  restart|force-reload)
+	log_daemon_msg "Restarting $DESC" "$NAME "
+	do_stop
+	case "$?" in
+		0|1)
+			do_start
+			case "$?" in
+				0) log_end_msg 0 ;;
+				1) log_end_msg 1 ;; # Old process is still running
+				*) log_end_msg 1 ;; # Failed to start
+			esac
+			;;
+		*)
+			# Failed to stop
+			log_end_msg 1
+			;;
+		esac
+		;;
+  *)
+	echo "Usage: $SCRIPTNAME {start|stop|status|restart|force-reload}" >&2
+	exit 3
+	;;
+esac
+
+:
diff -rupN jailkit/ini/jk_check.ini jailkit_wrk/ini/jk_check.ini
--- jailkit/ini/jk_check.ini	2003-12-22 17:27:11.000000000 +0100
+++ jailkit_wrk/ini/jk_check.ini	2013-11-27 06:36:52.000000000 +0100
@@ -1,21 +1 @@
-[/home/testchroot]
-# jk_check does not run any tests in this directory (useful for proc filesystem)
-# be careful!! there is I repeat NO SINGLE TEST in this directory
-#ignorepatheverywhere = 
-
-# jk_check compares files if they are equal to their counterparts in the real system,
-# using md5sum(). In the specified directories it will not test if files are equal
-# it will still test for world writable directories and setuid files
-ignorepathoncompare = /home/testchroot/home, /home/testchroot/etc
-
-# jk_check tests directory permissions, if you deliberately made some directories writable
-# for group or others, or you don't care, specify them here
-ignorewritableforgroup = /home/testchroot/home
-ignorewritableforothers = /home/testchroot/home/tmp
-
-# jk_check tests for setuid root and setgid root files
-# if you deliberately have such files specify them here
-ignoresetuidexecuteforuser = /home/testchroot/usr/bin/smbmnt, /home/testchroot/usr/bin/smbumount
-ignoresetuidexecuteforgroup = /home/testchroot/usr/bin/smbmnt, /home/testchroot/usr/bin/smbumount
-ignoresetuidexecuteforothers = 
-
+# See man jk_check
diff -rupN jailkit/ini/jk_chrootsh.ini jailkit_wrk/ini/jk_chrootsh.ini
--- jailkit/ini/jk_chrootsh.ini	2004-01-11 17:12:46.000000000 +0100
+++ jailkit_wrk/ini/jk_chrootsh.ini	2013-12-04 01:30:54.000000000 +0100
@@ -1,8 +1,3 @@
-## example for a user
-#[test]
-#env= DISPLAY, XAUTHORITY
-#
-##example for a group, there should be only 1 space inbetween the words!
-#[group users]
-#env = DISPLAY, XAUTHORITY
-#
\ Pas de fin de ligne à la fin du fichier
+# See man jk_chrootsh
+[DEFAULT]
+env = TERM, PATH
diff -rupN jailkit/ini/jk_init.ini jailkit_wrk/ini/jk_init.ini
--- jailkit/ini/jk_init.ini	2012-08-10 22:16:47.000000000 +0200
+++ jailkit_wrk/ini/jk_init.ini	2013-12-08 04:46:41.353767318 +0100
@@ -1,23 +1,16 @@
+# See man jk_init
 [uidbasics]
-# this section probably needs adjustment on 64bit systems
-# or non-Linux systems
 comment = common files for all jails that need user/group information
 paths = /lib/libnsl.so.1, /lib64/libnsl.so.1, /lib/libnss*.so.2, /lib64/libnss*.so.2, /lib/i386-linux-gnu/libnsl.so.1, /lib/i386-linux-gnu/libnss*.so.2, /lib/x86_64-linux-gnu/libnsl.so.1, /lib/x86_64-linux-gnu/libnss*.so.2, /etc/nsswitch.conf, /etc/ld.so.conf
-# Solaris needs 
-# paths = /etc/default/nss, /lib/libnsl.so.1, /usr/lib/nss_*.so.1, /etc/nsswitch.conf
 
 [netbasics]
 comment = common files for all jails that need any internet connectivity
 paths = /lib/libnss_dns.so.2, /lib64/libnss_dns.so.2, /etc/resolv.conf, /etc/host.conf, /etc/hosts, /etc/protocols, /etc/services
-# on Solaris devices /dev/udp and /dev/tcp might be needed too, not sure
 
 [logbasics]
 comment = timezone information and log sockets
 paths = /etc/localtime
 need_logsocket = 1
-# Solaris does not need logsocket
-# but needs 
-# devices = /dev/log, /dev/conslog
 
 [jk_lsh]
 comment = Jailkit limited shell
@@ -37,8 +30,8 @@ devices = /dev/null
 
 [git]
 comment = Fast Version Control System
-paths = /usr/bin/git*, /usr/share/git-core
-includesections = editors
+paths = /usr/bin/git*, /usr/share/git-core, /usr/bin/basename, /bin/uname
+includesections = editors, perl
 
 [scp]
 comment = ssh secure copy
@@ -51,8 +44,6 @@ comment = ssh secure ftp
 paths = /usr/lib/sftp-server, /usr/libexec/openssh/sftp-server, /usr/lib/misc/sftp-server, /usr/libexec/sftp-server, /usr/lib/openssh/sftp-server
 includesections = netbasics, uidbasics
 devices = /dev/urandom, /dev/null
-# on solaris 
-#paths = /usr/lib/ssh/sftp-server
 
 [ssh]
 comment = ssh secure shell
@@ -71,7 +62,7 @@ devices = /dev/null
 
 [basicshell]
 comment = bash based shell with several basic utilities
-paths = /bin/sh, bash, ls, cat, chmod, mkdir, cp, cpio, date, dd, echo, egrep, false, fgrep, grep, gunzip, gzip, ln, ls, mkdir, mktemp, more, mv, pwd, rm, rmdir, sed, sh, sleep, sync, tar, touch, true, uncompress, zcat, /etc/motd, /etc/issue, /etc/bash.bashrc, /etc/bashrc, /etc/profile, /usr/lib/locale/en_US.utf8
+paths = /bin/sh, bash, ls, cat, chmod, mkdir, cp, cpio, date, dd, echo, egrep, false, fgrep, grep, gunzip, gzip, ln, ls, mkdir, mktemp, more, mv, pwd, rgrep, rm, rmdir, sed, sh, sleep, sync, tar, touch, true, uncompress, zcat, /etc/motd, /etc/issue, /etc/bash.bashrc, /etc/bashrc, /etc/profile, /usr/lib/locale/C.UTF-8
 users = root
 groups = root
 includesections = uidbasics
@@ -88,16 +79,16 @@ includesections = basicshell, midnightco
 
 [terminfo]
 comment = terminfo databases, required for ncurses
-paths = /etc/terminfo, /usr/share/terminfo
+paths = /etc/terminfo, /usr/share/terminfo, /lib/terminfo
 
 [editors]
-comment = vim, joe and nano
+comment = vim, joe, nano and pico
 includesections = terminfo
-paths = joe, nano, vi, vim, /etc/vimrc, /etc/joe, /usr/share/vim
+paths = joe, nano, vi, vim, /etc/vimrc, /etc/joe, /usr/share/vim, /usr/bin/pico
 
 [netutils]
 comment = several internet utilities like wget, ftp, rsync, scp, ssh
-paths = wget, lynx, ftp, host, rsync, smbclient
+paths = wget, ftp, rsync
 includesections = netbasics, ssh, sftp, scp
 
 [apacheutils]
@@ -113,9 +104,8 @@ comment = jail for the openvpn daemon
 paths = /usr/sbin/openvpn
 users = root,nobody
 groups = root,nogroup
-includesections = netbasics
-devices = /dev/urandom, /dev/random, /dev/net/tun
 includesections = netbasics, uidbasics
+devices = /dev/urandom, /dev/random, /dev/net/tun
 need_logsocket = 1
 
 [apache]
@@ -151,3 +141,16 @@ paths_w_setuid = /bin/ping
 #comment = xterm
 #paths = /usr/bin/X11/xterm, /usr/share/terminfo, /etc/terminfo
 #devices = /dev/pts/0, /dev/pts/1, /dev/pts/2, /dev/pts/3, /dev/pts/4, /dev/ptyb4, /dev/ptya4, /dev/tty, /dev/tty0, /dev/tty4
+
+[mysql-client]
+comment = MySQL client
+users = mysql
+groups = mysql
+paths = /usr/bin/mysql
+includesections = netbasics, uidbasics
+
+[imscp-base]
+comment = Pre-selected sections, users and groups
+users = root, www-data
+groups = root, www-data
+includesections = extendedshell, netutils
diff -rupN jailkit/ini/jk_lsh.ini jailkit_wrk/ini/jk_lsh.ini
--- jailkit/ini/jk_lsh.ini	2006-04-01 22:57:10.000000000 +0200
+++ jailkit_wrk/ini/jk_lsh.ini	2013-11-27 06:36:52.000000000 +0100
@@ -1,13 +1 @@
-## example for a user
-#[test]
-#paths= /usr/lib/
-#executables= /usr/lib/sftp-server
-#allow_word_expansion = 0
-#umask = 002
-#
-##example for a group, there should be only 1 space inbetween the words!
-#[group users]
-#paths = /usr/bin
-#executables = /usr/bin/cvs
-#allow_word_expansion = 0
-#environment= HELIX_PATH=/opt/RealPlayer/, TMP=/tmp/
+# See man jk_lsh
diff -rupN jailkit/ini/jk_socketd.ini jailkit_wrk/ini/jk_socketd.ini
--- jailkit/ini/jk_socketd.ini	2007-01-10 00:10:39.000000000 +0100
+++ jailkit_wrk/ini/jk_socketd.ini	2013-11-27 06:36:52.000000000 +0100
@@ -1,5 +1 @@
-# example
-#[/home/testchroot/dev/log]
-#base = 1024
-#peak = 10240
-#interval = 2.0
+# See man jk_socketd
diff -rupN jailkit/ini/jk_uchroot.ini jailkit_wrk/ini/jk_uchroot.ini
--- jailkit/ini/jk_uchroot.ini	2009-10-19 17:37:53.000000000 +0200
+++ jailkit_wrk/ini/jk_uchroot.ini	2013-11-27 06:36:52.000000000 +0100
@@ -1,7 +1 @@
-#[john]
-#allowed_jails = /srv/johnjail, /srv/commonjail
-#skip_injail_passwd_check = 1
-#
-#[group users]
-#allowed_jails = /srv/commonjail
-#skip_injail_passwd_check = 1
+# man jk_uchroot
diff -rupN jailkit/ini/jk_update.ini jailkit_wrk/ini/jk_update.ini
--- jailkit/ini/jk_update.ini	2007-03-06 10:00:34.000000000 +0100
+++ jailkit_wrk/ini/jk_update.ini	2013-11-27 06:36:52.000000000 +0100
@@ -1,5 +1,3 @@
-[/home/testjail]
-skips = /usr/bin/myscript
-hardlinks = 0
-directories = /usr
-
+# See man jk_update
+[DEFAULT]
+hardlinks = 1
diff -rupN jailkit/Makefile.in jailkit_wrk/Makefile.in
--- jailkit/Makefile.in	2010-09-11 15:45:26.000000000 +0200
+++ jailkit_wrk/Makefile.in	2013-12-11 01:05:40.564352241 +0100
@@ -39,12 +39,14 @@ jailkit: all
 
 all:
 	@cd src/ && $(MAKE) all
+	@cd pl/ && $(MAKE) all
 	@cd py/ && $(MAKE) all
 	@cd man/ && $(MAKE) all
 
 clean:
 	rm -f core *~ ini/*~
 	@cd src/ && $(MAKE) clean
+	@cd pl/ && $(MAKE) clean
 	@cd py/ && $(MAKE) clean
 	@cd man/ && $(MAKE) clean
 
@@ -52,6 +54,7 @@ distclean: clean
 	rm -rf autom4te.cache/
 	rm -f Makefile config.log config.status config.cache
 	@cd src/ && $(MAKE) distclean
+	@cd pl/ && $(MAKE) distclean
 	@cd py/ && $(MAKE) distclean
 	@cd man/ && $(MAKE) distclean
 
@@ -65,6 +68,7 @@ install:
 		fi ;\
 	done
 	@cd src/ && $(MAKE) install
+	@cd pl/ && $(MAKE) install
 	@cd py/ && $(MAKE) install
 	@cd man/ && $(MAKE) install
 	# test if the jk_chrootsh is already in /etc/shells
@@ -76,12 +80,11 @@ install:
 		fi \
 	fi
 
-
 uninstall:
 	rm -f ${iniprefix}/*.ini
+	@cd pl/ && $(MAKE) uninstall
 	@cd py/ && $(MAKE) uninstall
 	@cd man/ && $(MAKE) uninstall
 	@cd src/ && $(MAKE) uninstall
 	-rmdir --ignore-fail-on-non-empty ${DESTDIR}${iniprefix}
 	@echo "You must manually remove jk_chrootsh from /etc/shells"
-# remove jk_chrootsh from /etc/shells
diff -rupN jailkit/man/jk_cp.8 jailkit_wrk/man/jk_cp.8
--- jailkit/man/jk_cp.8	2010-02-07 17:13:06.000000000 +0100
+++ jailkit_wrk/man/jk_cp.8	2013-12-08 05:05:08.445742942 +0100
@@ -7,7 +7,7 @@ jk_cp \- a utility to copy files includi
 
 .B jk_cp -j jail source
 
-.B jk_cp -v -k -f -j jail source
+.B jk_cp -v -k -f -o -s -i -j jail source
 
 .SH DESCRIPTION
 
@@ -38,6 +38,12 @@ Try to create hardlinks instead of copyi
 .BR \-o\ \-\-owner
 Retains the file ownership and group when copying files and directories.
 .TP
+.BR \-s\ \-\-setuid
+Retains the setuid and setgid bits when copying the files and directories.
+.TP
+.BR \-i\ \-\-ignore-missing
+Ignore missing files instead of raising a fatal error.
+.TP
 .BR \-v\ \-\-verbose
 Will give verbose output
 .TP
diff -rupN jailkit/man/Makefile.in jailkit_wrk/man/Makefile.in
--- jailkit/man/Makefile.in	2007-11-07 23:32:31.000000000 +0100
+++ jailkit_wrk/man/Makefile.in	2013-11-27 06:36:52.000000000 +0100
@@ -77,7 +77,7 @@ jk_update.8.gz: jk_update.8
 jailkit: ${MANS}
 
 all: jailkit
-	
+
 install: jailkit
 	${INSTALL} -d -m 755 ${DESTDIR}${mandir}/man8/
 	for file in ${MANS} ; do \
diff -rupN jailkit/pl/jk_mountdirs.in jailkit_wrk/pl/jk_mountdirs.in
--- jailkit/pl/jk_mountdirs.in	1970-01-01 01:00:00.000000000 +0100
+++ jailkit_wrk/pl/jk_mountdirs.in	2013-12-13 13:01:28.863601904 +0100
@@ -0,0 +1,75 @@
+#!/usr/bin/perl
+
+# i-MSCP - internet Multi Server Control Panel
+# Copyright (C) 2010-2013 by Laurent Declercq <l.declercq@nuxwin.com>
+#
+# This program is free software; you can redistribute it and/or
+# modify it under the terms of the GNU General Public License
+# as published by the Free Software Foundation; either version 2
+# of the License, or (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+#
+# @category    i-MSCP
+# @package     iMSCP_Plugin
+# @subpackage  Jailkit
+# @copyright   2010-2013 by i-MSCP | http://i-mscp.net
+# @author      Laurent Declercq <l.declercq@nuxwin.com>
+# @link        http://i-mscp.net i-MSCP Home Site
+# @license     http://www.gnu.org/licenses/gpl-2.0.html GPL v2
+
+use strict;
+use warnings;
+
+use lib "/var/www/imscp/engine/PerlLib";
+
+use iMSCP::Debug;
+use iMSCP::Getopt;
+use iMSCP::Boot;
+
+$ENV{'LC_MESSAGES'} = 'C';
+
+umask(027);
+
+newDebug('jailkit-plugin-mountdirs.log');
+
+my $options = {
+	'action' => 'mount'
+};
+
+iMSCP::Getopt->parseNoDefault(
+	qq{ Usage: jk_mountdirs [options]
+
+ Mount/Umount host directories in jails
+
+ -u, --umount Umount instead of mount.}
+  'umount|u', sub { $options->{'action'} = 'umount' }
+);
+
+silent(1);
+
+iMSCP::Boot->getInstance()->boot({ 'norequirements' => 'yes', 'config_readonly' => 'yes', 'nolock' => 'yes' });
+
+my $plugin = "$main::imscpConfig{'ENGINE_ROOT_DIR'}/Plugins/Jailkit.pm";
+my $rs = 0;
+
+eval { require $plugin };
+
+if($@) {
+	error($@);
+	$rs = 1;
+} else {
+	$plugin = Plugin::Jailkit->getInstance();
+
+	$rs = $plugin->processHostDirs($options{'action'});
+	$rs ||= $plugin->processHostHomedirs($options{'action'});
+}
+
+exit $rs;
diff -rupN jailkit/pl/Makefile.in jailkit_wrk/pl/Makefile.in
--- jailkit/pl/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ jailkit_wrk/pl/Makefile.in	2013-12-11 06:02:48.687959701 +0100
@@ -0,0 +1,52 @@
+# i-MSCP - internet Multi Server Control Panel
+# Copyright (C) 2010-2013 by Laurent Declercq <l.declercq@nuxwin.com>
+#
+# This program is free software; you can redistribute it and/or
+# modify it under the terms of the GNU General Public License
+# as published by the Free Software Foundation; either version 2
+# of the License, or (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+
+INSTALL = @INSTALL@
+prefix = @prefix@
+exec_prefix = @exec_prefix@
+sbindir = @sbindir@
+datadir = @datadir@
+datarootdir  = @datarootdir@
+sysconfdir = @sysconfdir@
+PREFIX = ${prefix}
+PERLINTERPRETER = @PERLINTERPRETER@
+IMSCPPERLLIB = @IMSCPPERLLIB@
+
+.SUFFIXES:
+.SUFFIXES: .in
+
+.in:
+	sed -e "s!/var/www/imscp/engine/PerlLib!$(IMSCPPERLLIB)!" \
+	    -e "s:#!/usr/bin/perl:#!$(PERLINTERPRETER):" < $< > $@
+
+jailkit: jk_mountdirs
+
+all: jailkit
+
+install: all
+	${INSTALL} -d -m 755 ${DESTDIR}${sbindir}
+	${INSTALL} -m 0755 jk_mountdirs ${DESTDIR}${sbindir}/
+
+uninstall:
+	rm -f ${DESTDIR}${sbindir}/jk_mountdirs
+
+clean:
+	rm -f *~
+	rm -f jk_mountdirs
+
+distclean: clean
+	rm -f Makefile
diff -rupN jailkit/py/jk_addjailuser.in jailkit_wrk/py/jk_addjailuser.in
--- jailkit/py/jk_addjailuser.in	2007-03-06 20:28:46.000000000 +0100
+++ jailkit_wrk/py/jk_addjailuser.in	2013-11-27 06:42:14.000000000 +0100
@@ -42,7 +42,6 @@ sys.path.append(LIBDIR)
 import jk_lib
 
 def usage():
-	print
 	print '*** jk_addjailuser is deprecated ***'
 	print
 	print 'please add the user like any other user, and use jk_jailuser to jail the user'
@@ -56,7 +55,6 @@ def usage():
 	print '       [-p passwd] -r [-s shell] [-u uid]'
 	print '       [-v] | [--verbose]'
 	print
-	
 
 def getjail_and_user(args):
 	if (len(args)==0):
@@ -252,4 +250,3 @@ def main():
  
 if __name__ == "__main__":
     main()
-    
diff -rupN jailkit/py/jk_check.in jailkit_wrk/py/jk_check.in
--- jailkit/py/jk_check.in	2011-01-27 09:18:59.000000000 +0100
+++ jailkit_wrk/py/jk_check.in	2013-11-27 06:42:14.000000000 +0100
@@ -260,16 +260,17 @@ def clean_exit(errno, message):
 	sys.exit(errno)
 
 def usage():
-	print "Usage: "+sys.argv[0]+" [OPTIONS]"
-	print ""
-	print "-h --help              : this help screen"
-	print "-c, --configfile=FILE  : specify configfile location"
-	print "-v, --verbose          : show what is being tested"
-	print ""
+	print 'Usage: '+sys.argv[0]+' [OPTIONS]'
+	print 'Check a jail for security problem'
+	print
+	print '-h --help             : this help screen'
+	print '-c, --configfile=FILE : specify configfile location'
+	print '-v, --verbose         : show what is being tested'
+	print
 
 def main():
 	try:
-		opts, args = getopt.getopt(sys.argv[1:], "vhc:", ["help", "configfile=", "verbose"])
+		opts, args = getopt.getopt(sys.argv[1:], 'vhc:', ['help', 'configfile=', 'verbose'])
 	except getopt.GetoptError:
 		usage()
 		sys.exit(1)
diff -rupN jailkit/py/jk_cp.in jailkit_wrk/py/jk_cp.in
--- jailkit/py/jk_cp.in	2012-08-02 22:55:27.000000000 +0200
+++ jailkit_wrk/py/jk_cp.in	2013-12-08 04:50:35.117762172 +0100
@@ -48,18 +48,23 @@ def startcopy(config, chroot, filestocop
 	jk_lib.gen_library_cache(chroot)
 
 def usage():
-	print "Usage: "+sys.argv[0]+" -j <jail> [OPTIONS] <files and directories>"
-	print ""
-	print "-h --help          : this help screen"
-	print "-j, --jail         : the jail to copy to"
-	print "-v, --verbose      : show what is being copied"
-	print "-f, --force        : overwrite existing files"
-	print "-k, --hardlink     : use hardlinks if possible"
-	print "-o, --owner        : retain file ownership and group"
-	print "-s, --setuid       : retain file setuid/setgid bits"
-	print "\nNote: if no jail is specified, the first argument is\nconsidered to be the jail\n"
+	print 'Usage: '+sys.argv[0]+' -j <jail> [OPTIONS] <files and directories>'
+	print 'Copy files including permissions and libraries into a jail'
+	print
+	print '-h --help            : this help screen'
+	print '-j, --jail=JAILDIR   : the jail to copy to'
+	print '-v, --verbose        : show what is being copied'
+	print '-f, --force          : overwrite existing files'
+	print '-k, --hardlink       : use hardlinks if possible'
+	print '-o, --owner          : retain file ownership and group'
+	print '-s, --setuid         : retain file setuid/setgid bits'
+	print '-i, --ignore-missing : ignore missing files'
+	print
+	print 'Note: For backwards compatibility, if no jail is specified, the'
+	print '      first argument after the options will be used as jail'
+	print
 
-def testargs(jail, args):
+def testargs(jail, args, ignoremissing):
 	if (len(args) == 0 or jail == None):
 		sys.stderr.write('ERROR: need at least a chroot directory and a file to copy\n\n')
 		usage()
@@ -69,18 +74,19 @@ def testargs(jail, args):
 		print ""
 		usage()
 		sys.exit(3)
-	for file in args:
-		if (not os.path.exists(file)):
-			sys.stderr.write('ERROR: '+file+' does not exist\n\n')
-			usage()
-			sys.exit(4)
+	if(not ignoremissing):
+		for file in args:
+			if (not os.path.exists(file)):
+				sys.stderr.write('ERROR: '+file+' does not exist\n\n')
+				usage()
+				sys.exit(4)
 
 def main():
 	if (os.getuid()!=0):
 		print 'cannot run without root privileges'
 		sys.exit(5)
 	try:
-		opts, args = getopt.getopt(sys.argv[1:], 'fh?vkojs:', ['help', 'verbose', 'force', 'hardlink', 'owner', 'jail', 'setuid'])
+		opts, args = getopt.getopt(sys.argv[1:], 'fh?vkosij:', ['help', 'verbose', 'force', 'hardlink', 'owner', 'jail=', 'setuid', 'ignore-missing'])
 	except getopt.GetoptError:
 		usage()
 		sys.exit(1)
@@ -90,6 +96,7 @@ def main():
 	config['hardlink'] = 0
 	config['retainowner'] = 0
 	config['retainsetuid'] = 0
+	config['ignoremissing'] = 0
 	jail = None
 	for o, a in opts:
 		if o in ("-h",'?', "--help"):
@@ -107,11 +114,13 @@ def main():
 			config['retainowner'] = 1
 		if o in ("-s", "--setuid"):
 			config['retainsetuid'] = 1
+		if o in ("-i", "--ignore-missing"):
+			config['ignoremissing'] = 1
 	if (jail == None and len(args)>0 ):
 		jail = args[0]
 		args = args[1:]
 	args = jk_lib.find_files_in_path(args)
-	testargs(jail, args)
+	testargs(jail, args, config['ignoremissing'])
 	if (jail[-1] != '/'): jail = jail+'/'
 	if (jk_lib.chroot_is_safe(jail)!=1):
 		sys.exit(6)
diff -rupN jailkit/py/jk_init.in jailkit_wrk/py/jk_init.in
--- jailkit/py/jk_init.in	2012-08-02 22:55:27.000000000 +0200
+++ jailkit_wrk/py/jk_init.in	2013-11-27 06:42:14.000000000 +0100
@@ -164,20 +164,21 @@ def activateConfig(config, jail, args):
 	jk_lib.gen_library_cache(jail)
 	
 def usage():
-	print ''
-	print "Usage: "+sys.argv[0]+" [OPTIONS]"
-	print "Usage: "+sys.argv[0]+" [OPTIONS] -j jaildir sections..."
-	print ''
-	print "-h --help              : this help screen"
-	print "-c, --configfile=FILE  : specify configfile location"
-	print '-l, --list             : list all available sections in the configfile'
-	print '-j, --jail=             : specify the jail to use.' 
-	print '     For backwards compatibility, if no jail is specified, the first'
-	print '     argument after the options will be used as jail'
-	print "-v, --verbose          : show what is being done"
-	print "-f, --force            : force overwriting of existing files"
-	print "-k, --hardlink         : use hardlinks if possible"
-	print ''
+	print 'Usage: '+sys.argv[0]+' [OPTIONS]'
+	print 'Usage: '+sys.argv[0]+' [OPTIONS] -j jaildir sections...'
+	print 'Initialize a jail'
+	print
+	print '-h --help             : this help screen'
+	print '-c, --configfile=FILE : specify configfile location'
+	print '-l, --list            : list all available sections in the configfile'
+	print '-j, --jail=JAILDIR    : specify the jail to use.'
+	print '-v, --verbose         : show what is being done'
+	print '-f, --force           : force overwriting of existing files'
+	print '-k, --hardlink        : use hardlinks if possible'
+	print
+	print 'Note: For backwards compatibility, if no jail is specified, the'
+	print '      first argument after the options will be used as jail'
+	print
 
 def listsections(file):
 	cfg = ConfigParser.ConfigParser()
@@ -207,7 +208,7 @@ def main():
 		print 'Cannot create chroot jail without root privileges. Abort.'
 		sys.exit(5)
 	try:
-		opts, args = getopt.getopt(sys.argv[1:], "vhflc:kj:", ["help", "configfile=", "verbose", "force", 'list', 'hardlink', 'jail'])
+		opts, args = getopt.getopt(sys.argv[1:], 'vhflc:kj:', ['help', 'configfile=', 'verbose', 'force', 'list', 'hardlink', 'jail='])
 	except getopt.GetoptError:
 		usage()
 		sys.exit(1)
@@ -232,8 +233,11 @@ def main():
 			config['force'] = 1
 		if o in ("-k", "--hardlink"):
 			config['hardlink'] = 1
-		if o in ("-j", "--jail="):
+		if o in ("-j", "--jail"):
 			jail = a
+	if (jail == None and len(args)>0 ):
+		jail = args[0]
+		args = args[1:]
 	if (list ==1):
 		listsections(config['file'])
 		sys.exit()
diff -rupN jailkit/py/jk_jailuser.in jailkit_wrk/py/jk_jailuser.in
--- jailkit/py/jk_jailuser.in	2011-04-27 17:32:43.000000000 +0200
+++ jailkit_wrk/py/jk_jailuser.in	2013-11-27 06:42:14.000000000 +0100
@@ -237,15 +237,15 @@ def user_exists(user):
 	return 0
 
 def usage():
-	print
 	print 'Usage: '+sys.argv[0]+' [OPTIONS] username [more usernames]'
+	print 'Put an existing user in a jail'
 	print
-	print ' -j | --jail= jaildir   : jail directory'
-	print ' -v | --verbose        : verbose output'
-	print ' -n | --noninteractive : no user interaction'
-	print ' -s | --shell= shell    : set shell inside jail ('+PREFIX+'/sbin/jk_lsh default)'
-	print ' -m | --move           : move home if home outside jail'
-	print ' -h | --help           : this message'
+	print '-j, --jail=JAILDIR   : jail directory'
+	print '-v, --verbose        : verbose output'
+	print '-n, --noninteractive : no user interaction'
+	print '-s, --shell= shell   : set shell inside jail ('+PREFIX+'/sbin/jk_lsh default)'
+	print '-m, --move           : move home if home outside jail'
+	print '-h, --help           : this message'
 	print
 
 def testjail(jail, shell):
@@ -348,4 +348,3 @@ def main():
 
 if __name__ == "__main__":
 	main()
-
diff -rupN jailkit/py/jk_list.in jailkit_wrk/py/jk_list.in
--- jailkit/py/jk_list.in	2006-10-29 12:56:50.000000000 +0100
+++ jailkit_wrk/py/jk_list.in	2013-11-27 06:42:14.000000000 +0100
@@ -125,14 +125,17 @@ def runList(verbose,jail):
 	return results
 
 def printusage():
-	print "jk_list, lists pocesses running in a chroot jail"
-	print "-h --help		print this message"
-	print "-j --jail=/path  list only processes in this jail"
-	print "-w --wide   print wide listing"
+	print 'Usage: '+sys.argv[0]+' [OPTIONS]'
+	print 'Lists pocesses running inside a jail'
+	print
+	print '-h, --help		  : print this message'
+	print '-j, --jail=JAILDIR : list only processes in this jail'
+	print '-w, --wide         : print wide listing'
+	print
 
 def main():
 	try:
-		opts, args = getopt.getopt(sys.argv[1:], "hwj:", ['wide', "help", "jail"])
+		opts, args = getopt.getopt(sys.argv[1:], 'hwj:', ['wide', 'help', 'jail='])
 	except getopt.GetoptError:
 		printusage()
 		sys.exit(1)
diff -rupN jailkit/py/jk_update.in jailkit_wrk/py/jk_update.in
--- jailkit/py/jk_update.in	2007-03-22 21:20:49.000000000 +0100
+++ jailkit_wrk/py/jk_update.in	2013-11-29 15:27:32.000000000 +0100
@@ -168,18 +168,19 @@ def updatejail(jail, dirs, skips, config
 			jk_lib.gen_library_cache(jail)
 
 def usage():
-	print ''
-	print "Usage: "+sys.argv[0]+" [OPTIONS] [DIRECTORIES]"
-	print '-h|--help          : this message'
-	print '-v|--verbose       : give verbose output'
-	print '-c|--configsection=: use options specified in section of config file'
-	print '-j|--jail=         : the jail to update'
-	print '-d|--dry-run       : show what will be done'
-	print '-s|--skip=         : skip file, option can be used multiple times'
-	print '-k|--hardlink      : use hardlinks if possible'
-	print ''
-	print 'if no directories are specified, jk_update will scan /bin /usr /lib and /opt'
-	print ''
+	print 'Usage: '+sys.argv[0]+' [OPTIONS] [DIRECTORIES]'
+	print 'Update and cleanup a jail according to changes on the real system'
+	print
+	print '-h|--help                  : this message'
+	print '-v|--verbose               : give verbose output'
+	print '-c|--configsection=SECTION : use options specified in section of config file'
+	print '-j|--jail=JAILDIR          : the jail to update'
+	print '-d|--dry-run               : show what will be done'
+	print '-s|--skip=FILE             : skip file, option can be used multiple times'
+	print '-k|--hardlink              : use hardlinks if possible'
+	print
+	print 'Note: If no directories are specified, jk_update will scan /bin /usr /lib and /opt'
+	print
 
 def main():
 	try:
diff -rupN jailkit/py/Makefile.in jailkit_wrk/py/Makefile.in
--- jailkit/py/Makefile.in	2010-10-06 11:43:17.000000000 +0200
+++ jailkit_wrk/py/Makefile.in	2013-11-27 06:36:52.000000000 +0100
@@ -46,7 +46,8 @@ PYLIBDIR=${datadir}/${PACKAGE}
 .SUFFIXES: .in .py .pyc
 
 .in:
-	sed -e "s!INIPREFIX='/etc/jailkit'!INIPREFIX='${INIPREFIX}'!" \
+	sed -e "s!PREFIX='/usr'!PREFIX='${PREFIX}'!" \
+	    -e "s!INIPREFIX='/etc/jailkit'!INIPREFIX='${INIPREFIX}'!" \
 	    -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" \
 	    -e "s!EXEPREFIX='[a-z/]*'!EXEPREFIX='${PREFIX}'!" \
 	    -e "s:#!/usr/bin/python:#!$(PYTHONINTERPRETER):" < $< > $@
diff -rupN jailkit/src/config.h.in jailkit_wrk/src/config.h.in
--- jailkit/src/config.h.in	2009-06-30 13:27:01.000000000 +0200
+++ jailkit_wrk/src/config.h.in	2013-12-11 06:51:32.911895316 +0100
@@ -1,5 +1,8 @@
 /* src/config.h.in.  Generated from configure.ac by autoheader.  */
 
+/* Define to 1 if you have the `cap_get_proc' function. */
+#undef HAVE_CAP_GET_PROC
+
 /* Define to 1 if you have the `clearenv' function. */
 #undef HAVE_CLEARENV
 
@@ -33,9 +36,21 @@
 /* Define to 1 if you have the `iberty' library (-liberty). */
 #undef HAVE_LIBIBERTY
 
+/* Define to 1 if you have the `posix4' library (-lposix4). */
+#undef HAVE_LIBPOSIX4
+
 /* Define to 1 if you have the `pthread' library (-lpthread). */
 #undef HAVE_LIBPTHREAD
 
+/* Define to 1 if you have the `rt' library (-lrt). */
+#undef HAVE_LIBRT
+
+/* Define to 1 if you have the `socket' library (-lsocket). */
+#undef HAVE_LIBSOCKET
+
+/* Define to 1 if you have the `xnet' library (-lxnet). */
+#undef HAVE_LIBXNET
+
 /* Define to 1 if you have the <math.h> header file. */
 #undef HAVE_MATH_H
 
@@ -45,12 +60,21 @@
 /* Define to 1 if you have the `mempcpy' function. */
 #undef HAVE_MEMPCPY
 
+/* Define to 1 if you have the `nanosleep' function. */
+#undef HAVE_NANOSLEEP
+
 /* Define to 1 if you have the <pthread.h> header file. */
 #undef HAVE_PTHREAD_H
 
 /* Define to 1 if you have the <pwd.h> header file. */
 #undef HAVE_PWD_H
 
+/* Define to 1 if you have the `recvfrom' function. */
+#undef HAVE_RECVFROM
+
+/* Define to 1 if you have the `send' function. */
+#undef HAVE_SEND
+
 /* Define to 1 if you have the <stdint.h> header file. */
 #undef HAVE_STDINT_H
 
@@ -75,6 +99,9 @@
 /* Define to 1 if you have the `strnlen' function. */
 #undef HAVE_STRNLEN
 
+/* Define to 1 if you have the <sys/capability.h> header file. */
+#undef HAVE_SYS_CAPABILITY_H
+
 /* Define to 1 if you have the <sys/socket.h> header file. */
 #undef HAVE_SYS_SOCKET_H
 
@@ -96,9 +123,6 @@
 /* Define to 1 if you have the <wordexp.h> header file. */
 #undef HAVE_WORDEXP_H
 
-#undef HAVE_SYS_CAPABILITY_H
-#undef HAVE_CAP_GET_PROC
-
 /* The package name. */
 #undef PACKAGE
 
@@ -114,6 +138,9 @@
 /* Define to the one symbol short name of this package. */
 #undef PACKAGE_TARNAME
 
+/* Define to the home page for this package. */
+#undef PACKAGE_URL
+
 /* Define to the version of this package. */
 #undef PACKAGE_VERSION
 
@@ -123,13 +150,40 @@
 /* Define to 1 if you have the ANSI C header files. */
 #undef STDC_HEADERS
 
-/* The package version. */
-#undef VERSION
-
+/* Enable extensions on AIX 3, Interix.  */
+#ifndef _ALL_SOURCE
+# undef _ALL_SOURCE
+#endif
 /* Enable GNU extensions on systems that have them.  */
 #ifndef _GNU_SOURCE
 # undef _GNU_SOURCE
 #endif
+/* Enable threading extensions on Solaris.  */
+#ifndef _POSIX_PTHREAD_SEMANTICS
+# undef _POSIX_PTHREAD_SEMANTICS
+#endif
+/* Enable extensions on HP NonStop.  */
+#ifndef _TANDEM_SOURCE
+# undef _TANDEM_SOURCE
+#endif
+/* Enable general extensions on Solaris.  */
+#ifndef __EXTENSIONS__
+# undef __EXTENSIONS__
+#endif
+
+
+/* The package version. */
+#undef VERSION
+
+/* Define to 1 if on MINIX. */
+#undef _MINIX
+
+/* Define to 2 if the system does not provide POSIX.1 features except with
+   this defined. */
+#undef _POSIX_1_SOURCE
+
+/* Define to 1 if you need to in order for `stat' and other things to work. */
+#undef _POSIX_SOURCE
 
 /* Define to `__inline__' or `__inline' if that's what the C compiler
    calls it, or to nothing if 'inline' is not supported under any name.  */
diff -rupN jailkit/src/jk_chrootsh.c jailkit_wrk/src/jk_chrootsh.c
--- jailkit/src/jk_chrootsh.c	2013-04-12 22:08:56.000000000 +0200
+++ jailkit_wrk/src/jk_chrootsh.c	2013-11-29 07:38:32.000000000 +0100
@@ -203,7 +203,7 @@ int main (int argc, char **argv) {
 		tmp++;
 	}
 
-	if (strcmp(tmp, PROGRAMNAME) != 0 && strcmp(tmp, "su")!= 0 && (tmp[0] != '-' || strcmp(&tmp[1], PROGRAMNAME))) {
+	if (strcmp(tmp, PROGRAMNAME) != 0 && strcmp(tmp, "su")!= 0 && strcmp(tmp, "-su")!= 0 && strcmp(tmp, "-"PROGRAMNAME)!=0) {
 		DEBUG_MSG("wrong name, tmp=%s, &tmp[1]=%s\n", tmp, &tmp[1]);
 		syslog(LOG_ERR, "abort, "PROGRAMNAME" is called as %s", argv[0]);
 		exit(1);
diff -rupN jailkit/src/jk_lib.c jailkit_wrk/src/jk_lib.c
--- jailkit/src/jk_lib.c	2013-04-18 10:12:03.000000000 +0200
+++ jailkit_wrk/src/jk_lib.c	2013-11-29 07:36:55.000000000 +0100
@@ -195,7 +195,7 @@ int getjaildir(const char *oldhomedir, c
 		}
 		i--;
 	}
-	return 1;
+	return 0;
 }
 
 char *strip_string(char * string) {
diff -rupN jailkit/src/jk_lsh.c jailkit_wrk/src/jk_lsh.c
--- jailkit/src/jk_lsh.c	2013-04-18 10:12:03.000000000 +0200
+++ jailkit_wrk/src/jk_lsh.c	2013-11-27 06:36:52.000000000 +0100
@@ -237,9 +237,10 @@ int main (int argc, char **argv) {
 	DEBUG_MSG("setting umask\n");
 	umaskval = iniparser_get_octalint_at_position(parser, section, "umask", section_pos);
 	if (umaskval != -1) {
-		mode_t oldumask;
+		/*mode_t oldumask;
 		oldumask = umask(umaskval);
-		/*syslog(LOG_DEBUG, "changing umask from 0%o to 0%o", oldumask, umaskval);*/
+		syslog(LOG_DEBUG, "changing umask from 0%o to 0%o", oldumask, umaskval);*/
+		umask(umaskval);
 	}
 	if (iniparser_get_string_at_position(parser, section, "environment", section_pos, buffer, 1024) > 0) {
 		char **envs, **tmp;
diff -rupN jailkit/src/jk_socketd.c jailkit_wrk/src/jk_socketd.c
--- jailkit/src/jk_socketd.c	2008-04-23 19:46:02.000000000 +0200
+++ jailkit_wrk/src/jk_socketd.c	2013-11-29 15:03:22.000000000 +0100
@@ -165,8 +165,12 @@ static void socketlink_handle(Tsocketlin
 		if (numbytes < 0) {
 			DEBUG_MSG("recvfrom error %d: %s\n", errno, strerror(errno));
 		} else if (numbytes > 0) {
-			if (send(sl->outsocket, &buf, numbytes, 0) != numbytes) {
+			int ret = send(sl->outsocket, &buf, numbytes, 0);
+			if (ret == -1) {
 				DEBUG_MSG("send error %d: %s\n", errno, strerror(errno));
+				syslog(LOG_CRIT, "failed to write log message, error %d: %s",errno,strerror(errno));
+			} else if (ret != numbytes) {
+				syslog(LOG_WARNING, "failed to write complete log message, message was %d bytes, delivered %d bytes",numbytes, ret);
 			}
 			/* write(sl->outsocket, &buf, numbytes); */
 			gettimeofday(&sl->lasttime,NULL);
@@ -433,7 +437,7 @@ int main(int argc, char**argv) {
 		ret = testsafepath(path, 0,0);
 		if (ret != 0) {
 			syslog(LOG_ERR, "abort, path %s is not owned root:root or does not have 0644 permissions\n",path);
-			exit(53);		
+			exit(53);
 		}
 		
 		if (!(chdir(path)==0 && chroot(path)==0)) {
@@ -475,6 +479,15 @@ int main(int argc, char**argv) {
 		DEBUG_MSG("created thread %i for %s\n",i,sl[i]->inpath);
 	}
 	DEBUG_MSG("main thread starting work on socket\n");
+
+	/* NXW fixed: daemon hangup */
+	if (!nodetach) {
+		/* Close out the standard file descriptors */
+		close(STDIN_FILENO);
+		close(STDOUT_FILENO);
+		close(STDERR_FILENO);
+	}
+
 	socketlink_handle(sl[0]);
 /*	DEBUG_MSG("pause() for process %d\n",getpid());
 	pause();
diff -rupN jailkit/src/Makefile.in jailkit_wrk/src/Makefile.in
--- jailkit/src/Makefile.in	2013-04-12 21:47:41.000000000 +0200
+++ jailkit_wrk/src/Makefile.in	2013-11-27 06:36:52.000000000 +0100
@@ -41,7 +41,6 @@ LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 LDLIBS = @LIBS@
 
-
 BINARIES = jk_socketd jk_lsh jk_chrootsh jk_chrootlaunch jk_uchroot
 
 @HAVEPROCMAIL_TRUE@BINARIES += jk_procmailwrapper
